/*! For license information please see task_diary.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){"use strict";t=function(){return r};var n,r={},o=Object.prototype,a=o.hasOwnProperty,c=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(n){d=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var o=t&&t.prototype instanceof k?t:k,a=Object.create(o.prototype),s=new C(r||[]);return c(a,"_invoke",{value:B(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}r.wrap=f;var p="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function k(){}function E(){}function w(){}var b={};d(b,i,(function(){return this}));var T=Object.getPrototypeOf,x=T&&T(T(N([])));x&&x!==o&&a.call(x,i)&&(b=x);var S=w.prototype=k.prototype=Object.create(b);function I(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function L(t,n){function r(o,c,s,i){var l=h(t[o],t,c);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==e(d)&&a.call(d,"__await")?n.resolve(d.__await).then((function(e){r("next",e,s,i)}),(function(e){r("throw",e,s,i)})):n.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,i)}))}i(l.arg)}var o;c(this,"_invoke",{value:function(e,t){function a(){return new n((function(n,o){r(e,t,n,o)}))}return o=o?o.then(a,a):a()}})}function B(e,t,r){var o=p;return function(a,c){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===a)throw c;return{value:n,done:!0}}for(r.method=a,r.arg=c;;){var s=r.delegate;if(s){var i=O(s,r);if(i){if(i===g)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=y;var l=h(e,t,r);if("normal"===l.type){if(o=r.done?v:m,l.arg===g)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=v,r.method="throw",r.arg=l.arg)}}}function O(e,t){var r=t.method,o=e.iterator[r];if(o===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=n,O(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var a=h(o,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,g;var c=a.arg;return c?c.done?(t[e.resultName]=c.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,g):c:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,c=function e(){for(;++o<t.length;)if(a.call(t,o))return e.value=t[o],e.done=!1,e;return e.value=n,e.done=!0,e};return c.next=c}}throw new TypeError(e(t)+" is not iterable")}return E.prototype=w,c(S,"constructor",{value:w,configurable:!0}),c(w,"constructor",{value:E,configurable:!0}),E.displayName=d(w,u,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,d(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},r.awrap=function(e){return{__await:e}},I(L.prototype),d(L.prototype,l,(function(){return this})),r.AsyncIterator=L,r.async=function(e,t,n,o,a){void 0===a&&(a=Promise);var c=new L(f(e,t,n,o),a);return r.isGeneratorFunction(t)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},I(S),d(S,u,"Generator"),d(S,i,(function(){return this})),d(S,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},r.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return s.type="throw",s.arg=e,t.next=r,o&&(t.method="next",t.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],s=c.completion;if("root"===c.tryLoc)return r("end");if(c.tryLoc<=this.prev){var i=a.call(c,"catchLoc"),l=a.call(c,"finallyLoc");if(i&&l){if(this.prev<c.catchLoc)return r(c.catchLoc,!0);if(this.prev<c.finallyLoc)return r(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return r(c.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return r(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var c=o?o.completion:{};return c.type=e,c.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;_(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:N(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),g}},r}function n(e,t,n,r,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(o,a){var c=e.apply(t,r);function s(e){n(c,o,a,s,i,"next",e)}function i(e){n(c,o,a,s,i,"throw",e)}s(void 0)}))}}document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("task-form"),n=document.getElementById("task-date"),o=document.getElementById("start-time"),a=document.getElementById("end-time"),c=document.getElementById("task-desc"),s=document.getElementById("tasks-list");console.log("Initial task list items:",s.innerHTML),s.querySelectorAll("li").forEach((function(e){console.log(e.innerHTML)})),w();var i=document.getElementById("save-button"),l=document.getElementById("entries-container"),u=document.getElementById("move-to-backlog-button");if(e&&n&&o&&a&&c&&s&&i&&l){document.querySelectorAll(".tabs .tab").forEach((function(e){e.addEventListener("click",(function(){var e=this.dataset.tab;console.log("Tab clicked: ".concat(e)),"today"===e?p():"tomorrow"===e?y():"forgotten"===e&&k()}))})),e.addEventListener("submit",(function(e){e.preventDefault();var t=n.value,r=o.value,i=a.value,l=c.value;if(t&&l){var u=document.createElement("li"),d=document.createElement("input");d.type="checkbox",d.classList.add("task-checkbox"),d.value=l,u.appendChild(d),u.appendChild(document.createTextNode("".concat(t," ").concat(r,"-").concat(i,": ").concat(l))),s.appendChild(u),n.value="",o.value="",a.value="",c.value=""}})),i.addEventListener("click",(function(e){e.preventDefault(),console.log("Save button clicked");var t=document.getElementById("task-date").value,n=document.getElementById("start-time").value,r=document.getElementById("end-time").value,o=document.getElementById("task-desc").value.trim();console.log("Task Date: ".concat(t)),console.log("Start Time: ".concat(n)),console.log("End Time: ".concat(r)),console.log("Task Description: ".concat(o));var a=[];t&&o?(a.push({date:t,start_time:n,end_time:r,task_description:o}),console.log("Tasks to be saved:",a),fetch("/task-diary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:a,reflections:""})}).then((function(e){if(console.log("Save response:",e),!e.ok)throw new Error("Network response was not ok");return e.json()})).then((function(e){console.log("Response data from save:",e),e.success?(alert("Task diary entry saved!"),document.getElementById("task-form").reset()):alert("Error saving task diary entry.")})).catch((function(e){console.error("There was a problem with the fetch operation:",e)}))):alert("Please enter a valid date and description.")})),u.addEventListener("click",(function(e){console.log("Move to Backlog button clicked");var t=document.getElementById("task-date").value,n=document.getElementById("start-time").value,r=document.getElementById("end-time").value,o=document.getElementById("task-desc").value.trim();console.log("Task Date: ".concat(t)),console.log("Start Time: ".concat(n)),console.log("End Time: ".concat(r)),console.log("Task Description: ".concat(o));var a=[];t&&o?(a.push(o),console.log("Tasks to be moved to backlog:",a),fetch("/move_to_backlog",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_descriptions:a})}).then((function(e){if(console.log("Move to Backlog response:",e),!e.ok)throw new Error("Network response was not ok");return e.json()})).then((function(e){console.log("Response data from move to backlog:",e),e.message?(alert("Tasks moved to backlog successfully!"),document.getElementById("task-form").reset()):alert("Error moving tasks to backlog.")})).catch((function(e){console.error("There was a problem with the fetch operation:",e)}))):alert("Please enter a valid date and description.")}));var d=[];document.getElementById("move-tasks-button").addEventListener("click",(function(){var e=document.getElementById("pending-tasks-list"),t=[],n=[];if(e.querySelectorAll("li").forEach((function(e){var r=e.querySelector('input[type="checkbox"]');r&&r.checked?t.push(parseInt(r.value)):n.push(e)})),0!==t.length){var r=(new Date).toISOString().split("T")[0],o={task_ids:t,date:r};console.log("Payload being sent:",o),fetch("/tasks/select",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then((function(e){return e.json()})).then((function(e){if(e.message){d=t;var r=document.getElementById("closed-tasks-list"),o=document.getElementById("pending-tasks-list");t.forEach((function(e){var t=document.querySelector('input[value="'.concat(e,'"]'));if(t){var n=t.parentElement;n&&(n.querySelector('input[type="checkbox"]').checked=!1,r.appendChild(n))}})),o.innerHTML="",n.forEach((function(e){return o.appendChild(e)}))}else alert("Error closing tasks")})).catch((function(e){console.error("Error:",e)}))}else alert("No tasks selected to move.")})),document.getElementById("undo-move-button").addEventListener("click",(function(){var e=document.getElementById("closed-tasks-list"),t=[],n=[];e.querySelectorAll("li").forEach((function(e){var r=e.querySelector('input[type="checkbox"]');r&&r.checked?t.push(parseInt(r.value)):n.push(e)})),console.log("Reverting task IDs:",t),0!==t.length?fetch("/tasks/revert",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_ids:t})}).then((function(e){return e.json()})).then((function(r){if(r.message){console.log("Tasks reverted successfully:",r.message);var o=document.getElementById("pending-tasks-list");t.forEach((function(e){var t=document.querySelector('input[value="'.concat(e,'"]'));if(t){var n=t.parentElement;n&&(n.querySelector('input[type="checkbox"]').checked=!1,o.appendChild(n))}})),d=d.filter((function(e){return!t.includes(e)})),e.innerHTML="",n.forEach((function(t){return e.appendChild(t)}))}else console.error("Error reverting tasks:",r.error),alert("Error reverting tasks")})).catch((function(e){console.error("Fetch error:",e),alert("Error reverting tasks")})):alert("No tasks selected to revert.")})),document.getElementById("move-tasks-button-tomorrow").addEventListener("click",(function(){var e=document.getElementById("tomorrow-pending-tasks-list"),t=[],n=[];if(e.querySelectorAll("li").forEach((function(e){var r=e.querySelector('input[type="checkbox"]');r&&r.checked?t.push(parseInt(r.value)):n.push(e)})),0!==t.length){var r={task_ids:t};console.log("Payload being sent:",JSON.stringify(r)),fetch("/tasks/select",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((function(e){return e.json()})).then((function(e){if(e.message){var r=document.getElementById("tomorrow-closed-tasks-list"),o=document.getElementById("tomorrow-pending-tasks-list");t.forEach((function(e){var t=document.querySelector('input[value="'.concat(e,'"]'));if(t){var n=t.parentElement;n&&(n.querySelector('input[type="checkbox"]').checked=!1,r.appendChild(n))}})),o.innerHTML="",n.forEach((function(e){return o.appendChild(e)}))}else alert("Error closing tasks")})).catch((function(e){console.error("Error:",e)}))}else alert("No tasks selected to move.")})),document.getElementById("undo-move-button-tomorrow").addEventListener("click",(function(){var e=document.getElementById("tomorrow-closed-tasks-list"),t=[],n=[];e.querySelectorAll("li").forEach((function(e){var r=e.querySelector('input[type="checkbox"]');r&&r.checked?t.push(parseInt(r.value)):n.push(e)})),0!==t.length?fetch("/tasks/revert",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_ids:t})}).then((function(e){return e.json()})).then((function(r){if(r.message){var o=document.getElementById("tomorrow-pending-tasks-list");t.forEach((function(e){var t=document.querySelector('input[value="'.concat(e,'"]'));if(t){var n=t.parentElement;n&&(n.querySelector('input[type="checkbox"]').checked=!1,o.appendChild(n))}})),d=d.filter((function(e){return!t.includes(e)})),e.innerHTML="",n.forEach((function(t){return e.appendChild(t)}))}else console.error("Error reverting tasks:",r.error),alert("Error reverting tasks")})).catch((function(e){console.error("Fetch error:",e),alert("Error reverting tasks")})):alert("No tasks selected to revert.")})),document.querySelector('.tabs .tab[data-tab="forgotten"]').addEventListener("click",k),w(),window.viewTasksForDate=function(){return f.apply(this,arguments)},window.selectTasksForDate=function(){return h.apply(this,arguments)},window.fetchTodayTasks=p,window.fetchTomorrowTasks=y,window.fetchForgottenTasks=k}else console.error("One or more elements are missing from the DOM");function f(){return(f=r(t().mark((function e(){var n,r,o,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.getElementById("task-date").value,e.next=3,fetch("/tasks?date=".concat(n));case 3:return r=e.sent,e.next=6,r.json();case 6:o=e.sent,(a=document.getElementById("tasks-for-date")).innerHTML="",o.forEach((function(e){var t=document.createElement("div");t.textContent=e.task_description+("selected"===e.status?" (Selected)":""),a.appendChild(t)}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return h=r(t().mark((function e(){var n,r,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("selectTasksForDate function called"),n=document.getElementById("today-tasks-list"),r=[],n.querySelectorAll("li").forEach((function(e){var t=e.querySelector('input[type="checkbox"]'),n=e.dataset.status;t.checked&&"pending"===n&&r.push(parseInt(t.value))})),console.log("Selected task IDs:",r),o={task_ids:r},console.log("Payload being sent to /tasks/select:",JSON.stringify(o)),fetch("/tasks/select",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then((function(e){return console.log("Response from /tasks/select:",e),e.json()})).then((function(e){console.log("Data from /tasks/select:",e),e.message?(alert(e.message),r.forEach((function(e){document.querySelector('input[value="'.concat(e,'"]')).parentElement.dataset.status="selected"}))):e.error?alert("Error: ".concat(e.error)):alert("Unknown error occurred.")})).catch((function(e){console.error("Error:",e)}));case 8:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function p(){return m.apply(this,arguments)}function m(){return(m=r(t().mark((function e(){var n,r,o,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetchTodayTasks"),e.prev=1,e.next=4,fetch("/tasks/today");case 4:return n=e.sent,e.next=7,n.json();case 7:r=e.sent,console.log("Tasks fetched for today:",r),o=r.filter((function(e){return"pending"===e.status})),a=r.filter((function(e){return"selected"===e.status})),d=a.map((function(e){return e.id})),g(o,"pending-tasks-list"),g(a,"closed-tasks-list"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),console.error("Error fetching today's tasks:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[1,16]])})))).apply(this,arguments)}function y(){return v.apply(this,arguments)}function v(){return(v=r(t().mark((function e(){var n,r,o,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetchTomorrowTasks"),e.prev=1,e.next=4,fetch("/tasks/tomorrow");case 4:return n=e.sent,e.next=7,n.json();case 7:r=e.sent,o=r.filter((function(e){return"pending"===e.status})),a=r.filter((function(e){return"selected"===e.status})),d=a.map((function(e){return e.id})),g(o,"tomorrow-pending-tasks-list"),g(a,"tomorrow-closed-tasks-list"),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),console.error("Error fetching tomorrow's tasks:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[1,15]])})))).apply(this,arguments)}function g(e,t){var n=document.getElementById(t);if(n.innerHTML="",console.log("Displaying tasks in element: ".concat(t),e),0===e.length){var r=document.createElement("li");return r.textContent="No tasks found",void n.appendChild(r)}e.forEach((function(e){var t=document.createElement("li"),r=document.createElement("input");r.type="checkbox",r.value=e.id,t.dataset.status=e.status,t.appendChild(r),t.appendChild(document.createTextNode("".concat(e.task_description," (").concat(e.start_time," - ").concat(e.end_time,")"))),n.appendChild(t)}))}function k(){return E.apply(this,arguments)}function E(){return(E=r(t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetchForgottenTasks function executed"),e.prev=1,e.next=4,fetch("/tasks/forgotten");case 4:return n=e.sent,e.next=7,n.json();case 7:if(r=e.sent,Array.isArray(r)){e.next=11;break}return console.error("Invalid response format for forgotten tasks:",r),e.abrupt("return");case 11:console.log("Tasks for forgotten:",r),g(r,"forgotten-tasks-list"),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),console.error("Error fetching forgotten tasks:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[1,15]])})))).apply(this,arguments)}function w(){var e=document.getElementById("tasks-list");console.log("Initial task list items:"),e.querySelectorAll("li").forEach((function(e){console.log(e.innerHTML)})),fetch("/get-task-diary-entries").then((function(e){return e.json()})).then((function(t){console.log("Entries loaded from backend:",t),0===t.length&&console.log("No entries found in backend response."),l.innerHTML="",t.forEach((function(e){console.log("Processing entry:",e);var t=document.createElement("div");t.classList.add("entry");var n=document.createElement("h3");n.innerText="Date: ".concat(e.date),t.appendChild(n);var r=document.createElement("p"),o=e.tasks&&Array.isArray(e.tasks)?e.tasks.join(", "):"No tasks available";r.innerText="Tasks: ".concat(o),t.appendChild(r),l.appendChild(t)})),console.log("Final task list items:"),e.querySelectorAll("li").forEach((function(e){console.log(e.innerHTML)}))}))}}))})();